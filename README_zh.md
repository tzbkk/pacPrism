# pacPrism

![pacPrism Banner](assets/prism-banner.svg)

> 面向 Debian GNU/Linux 的半去中心化软件包分发系统

[English Version](README.md)

## 概述

pacPrism 是一个革命性的软件包分发系统，它解决了传统"中心-镜像"软件分发模式的基本限制。通过结合**访问层集中化**与**数据层去中心化**，pacPrism 提供了增强的可靠性、降低的延迟和更低的运营成本，同时保持与现有 Debian 软件包管理工具的完全兼容性。

### 核心理念

- **用户体验优先**：对最终用户完全透明 - 只需修改 `sources.list` 指向 pacPrism 网关，无需额外的客户端或插件
- **亚里士多德德性伦理**：基于可靠性、贡献度和本地声誉实现"德性驱动"的节点评估机制，避免区块链式的全局账本
- **可扩展愿景**：设计用于最终支持任何二进制制品分发（Docker 镜像、npm 包等），特别有利于网络受限或带宽昂贵的地区

## 架构

### 混合架构模型

pacPrism 采用**"集中化访问层 + 去中心化数据层"**混合方法：

- **访问层（集中化）**：**网关集群**作为唯一用户入口点提供统一的外部服务，确保兼容性和控制
- **数据层（去中心化）**：**P2P 网络**（DHT + Gossip）在服务器节点间分发 `.deb` 包和元数据，实现负载分配和冗余容错

### 核心组件

#### 1. 网关集群（"智能大脑"）
- 接收来自 APT 客户端的 HTTP/HTTPS 请求（模拟官方仓库行为）
- 查询 DHT 获取目标文件的可用节点列表
- 基于节点权重、延迟、声誉执行智能调度
- 当 P2P 网络无响应时自动回退到官方源
- 提供 TLS 终止、速率限制、日志审计等运维能力

#### 2. 对等节点（"骨干肌肉"）
- 存储部分或完整的 Debian 软件包副本
- 参与 DHT 路由和 Gossip 协议传播
- 响应来自网关或其他节点的文件请求
- 报告心跳和本地状态（用于抗脆弱机制）

#### 3. DHT & Gossip 网络（"神经网络"）
- **DHT（分布式哈希表）**：高效文件定位（Key = 包名/哈希，Value = 节点地址列表）
- **Gossip 协议**：传播节点加入/退出、健康状态、本地声誉更新
- **双 DHT 系统**：轻量级节点（低存储、高可用性）和重量级节点（高容量、稳定贡献）的独立 DHT

#### 4. 官方源（"信任锚点"）
- 作为最终回退源，确保内容真实性和完整性
- 提供用于验证的初始元数据（`Packages.gz`、`Release` 文件）
- P2P 网络的所有内容必须通过官方源签名验证

## 关键机制

### 安全优先设计
- 所有传输内容必须通过官方源签名验证
- 网关不缓存未经验证的内容，防止污染传播
- 节点身份可通过证书或预共享密钥（PSK）进行认证

### 主动抗脆弱性
- **心跳机制**：节点定期报告状态，网关动态调整路由权重
- **IPv6 优化**：利用 IPv6 多播进行节点发现，减少中央注册依赖
- **优雅降级**：当 P2P 不可用时无缝回退到官方源，对用户透明

### 德性驱动节点评估
- 无全局区块链记录；基于：
  - **本地声誉**（来自邻居节点的历史行为评估）
  - **可验证贡献**（成功有效文件交付计数/字节数）
  - **隐式权重**（在线时长、带宽稳定性等）
- 权重用于 DHT 路由优先级和网关调度决策

## 技术栈

- **核心系统**（网关、节点逻辑、DHT/Gossip协议）：**C++23**
  → 高性能、低延迟、细粒度内存控制
- **构建系统**: **CMake 3.14+**
  → 现代CMake实践与模块化配置
- **网络通信**: **Boost.Beast**（包含内置 Boost.Asio）
  → HTTP/1.1服务器实现，异步I/O
- **包管理**: **vcpkg**
  → 跨平台依赖管理

## 📚 文档

- [构建指南](docs/BUILD_GUIDE.md) - 详细构建说明与优化
- [版本系统](docs/VERSION_SYSTEM.md) - 模块化版本管理系统
- [当前状态](docs/CURRENT_STATUS.md) - 项目开发现状与路线图
- [开发日志](devlog_zh/README_DEVLOG.md) - 中文开发进度记录

## 安装

### 先决条件
- CMake 3.14 或更高版本
- C++23 兼容编译器

### 构建说明

```bash
# 克隆仓库
git clone https://github.com/tzbkk/pacPrism.git
cd pacPrism

# 配置项目
cmake -B build

# 构建项目
cmake --build build

# 运行 pacPrism
./build/bin/pacprism
```

## 开发

### 构建特定目标

```bash
# 仅构建主可执行文件
cmake --build build --target pacprism

# 仅构建网络库
cmake --build build --target network_dht

# 清理构建
cmake --build build --target clean
```

### 项目结构

```
pacPrism/
├── CMakeLists.txt          # 根 CMake 配置
├── src/                    # 主应用程序源码
├── lib/                    # 库组件
├── include/                # 头文件
└── docs/                   # 文档和 GitHub Pages
```

## 未来路线图

- 支持其他发行版（Ubuntu、Arch 等）
- 内容预取和智能缓存策略
- 可视化拓扑和贡献排行榜以激励节点参与
- 探索与 IPFS 或 BitTorrent 协议的互操作性

## 许可证

GPLv3